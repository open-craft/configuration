# Bootstrap packages must be installed with raw commands, because ubuntu
# xenial+ cloud images don't have python2.7 installed, and ansible doesn't yet
# support python3.

- name: Populate service facts
  service_facts:

- name: Wait until cloud-init has finished running
  raw: cloud-init status --wait
  when: "'cloud-init.target' in ansible_facts.services"

- name: Update apt-get
  raw: apt-get update -qq
  register: python_update_result
  until: python_update_result.rc == 0
  retries: 10
  delay: 10

- name: Install packages
  raw: "apt-get install -qq {{ item }}"
  with_items: "{{ python_packages }}"
