"""
gunicorn configuration file: http://docs.gunicorn.org/en/stable/configure.html

{{ ansible_managed }}
"""
import multiprocessing

preload_app = False
timeout = {{ EDXAPP_LMS_GUNICORN_TIMEOUT }}
bind = "{{ edxapp_lms_gunicorn_host }}:{{ edxapp_lms_gunicorn_port }}"
pythonpath = "{{ edxapp_code_dir }}"

{% if EDXAPP_LMS_MAX_REQ -%}
max_requests = {{ EDXAPP_LMS_MAX_REQ }}
{% endif -%}

{% if EDXAPP_WORKERS %}
workers = {{ EDXAPP_WORKERS.lms }}
{% else %}
workers = multiprocessing.cpu_count() * {{ worker_core_mult.lms }}
{% endif %}
{% if EDXAPP_WORKER_THREADS %}
threads = {{ EDXAPP_WORKER_THREADS.lms }}
{% endif %}
{% if EDXAPP_WORKER_CLASS %}
worker_class = {{ EDXAPP_WORKER_CLASS }}
{% endif %}
{% if EDXAPP_WORKER_MAX_REQUEST_JITTER %}
max_requests_jitter = {{ EDXAPP_WORKER_MAX_REQUEST_JITTER }}
{% endif %}



{{ common_pre_request }}

{{ common_close_all_caches }}

def post_fork(server, worker):
    close_all_caches()

{{ EDXAPP_LMS_GUNICORN_EXTRA_CONF }}
